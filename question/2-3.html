<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta name="format-detection" content="telephone=no">
  <title>怪诞咖啡</title>
</head>
<style>
  *{margin:0;padding:0;}
  g.type-TK>rect{fill:#00ffd0}
  text{font-weight:300;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px}
  .node rect{stroke:#999;fill:#fff;stroke-width:1.5px}
  .edgePath path{stroke:#333;stroke-width:1.5px}
  svg{box-sizing:border-box;border:solid 1px #07c160;width:100%;border-width:1px 0;}
</style>

<body>
  <svg id="svg-canvas" width=800 height=600></svg>
  <script src="../js/d3.v4.js"></script>
  <script src="../js/dagre-d3.js"></script>
  <script src="../config/config-2-3.js"></script>
  <script src="../config/config-2-3-arrow.js"></script>
  <script id="js">
  // Create the input graph
  var g = new dagreD3.graphlib.Graph()
    .setGraph({})
    .setDefaultEdgeLabel(function() { return {}; });

  // Here we"re setting nodeclass, which is used by our custom drawNodes function
  // below.
  config_2_3.forEach(item=>{
    const {rank,title,link,noteClass}=item;
    g.setNode(rank, { label:title, class: `type-${rank} ${noteClass}` });
  });

  g.nodes().forEach(function(v) {
    var node = g.node(v);
    // Round the corners of the nodes
    node.rx = node.ry = 5;
  });

  // Set up edges, no special attributes.
  config_2_3_arrow.forEach(item=>{
    const [start,end]=item;
    g.setEdge(start,end);
  })

  // Create the renderer
  var render = new dagreD3.render();

  // Set up an SVG group so that we can translate the final graph.
  var svg = d3.select("svg"),
    svgGroup = svg.append("g"),
    gs=d3.select("svg g");

  // Run the renderer. This is what draws the final graph.
  render(gs, g);

  const arr = gs._groups[0];
  arr.forEach((item, index) => {
    item.onclick = function() {
      console.log(item, index, 999)
    }
  })

  // Center the graph
  onCenter();
  document.body.onresize = function() {
    onCenter()
  }

  function onCenter() {
    var xCenterOffset = (document.body.clientWidth - g.graph().width) / 2;
    svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
    svg.attr("height", g.graph().height + 40);
  }
  </script>
</body>

</html>